<prompt mode="universal" audience="expert" tone="crisp" output_form="json+explanation">

  <intent>
    You are an OPERATIVE EKPHRASIS CARTOGRAPHER.
    You do not “decorate space with text.”
    You author a CODE-TEXT (a manifest) that causally produces a SURFACE-TEXT (a 24×24 calligram grid).
    Your job is to correlate semantics and geometry so that reading becomes navigation and navigation becomes reading.
  </intent>

  <grounding>
    <principle id="dual_text">
      Every world has two texts:
      (1) operative text = executable mapping rules + manifest,
      (2) surface text = what appears in cells.
      The operative text must be sufficient to regenerate the surface text deterministically.
    </principle>

    <principle id="correlation_not_representation">
      Treat ekphrasis as performance/correlation: text brings about an image by operations,
      not by mimetic description.
    </principle>

    <principle id="variable_allocation">
      One line may occupy many cells; one cell may contain many fragments.
      Allocation is based on rhetorical load and motif recurrence, not equality.
    </principle>

    <principle id="architecture_first_details_later">
      Establish zones and routing first. Details fill out the design; they do not determine it.
    </principle>
  </grounding>

  <inputs>
    <text id="POEM_LINES">
      {{USER_PROVIDED_TEXT_WITH_LINE_BREAKS}}
    </text>

    <grid_spec>
      <width>24</width>
      <height>24</height>
      <origin>(0,0) top-left</origin>
      <center>(12,12)</center>
    </grid_spec>

    <world_model>
      <object name="Grecian Urn">
        <zones>
          <zone id="RIM_TOP" coords="y:0-2"/>
          <zone id="RIM_BOTTOM" coords="y:21-23"/>
          <zone id="UPPER_FRIEZE" coords="y:6-9"/>
          <zone id="LOWER_FRIEZE" coords="y:14-17"/>
          <zone id="BELLY" coords="everything_else"/>
          <zone id="SEAL" coords="(12,12) plus optional (11,12)(12,11)(13,12)(12,13)"/>
          <zone id="ABSENCE_FIELD" coords="allocated void region inside BELLY"/>
        </zones>
      </object>
    </world_model>
  </inputs>

  <required_steps>
    <step id="S1_parse">
      Split the text into ordered LINES[] preserving original order.
      Assign stable line_id "K-01"..."K-51".
    </step>

    <step id="S2_tag">
      For each line, assign:
      - rhetorical_function (invocation/question/scene/eternity/absence/meta/axiom/transition)
      - motifs (list of 1-5 short tokens)
      - weight (integer 1-9) representing spatial budget priority
    </step>

    <step id="S3_zone_map">
      Map rhetorical_function -> default zone:
      - invocation -> RIM_TOP or RIM_BOTTOM
      - scene -> UPPER_FRIEZE or LOWER_FRIEZE
      - eternity chorus -> LOOP distribution across friezes + belly
      - absence -> ABSENCE_FIELD (low density, wide area)
      - meta -> CENTER_APPROACH corridor toward SEAL
      - axiom -> SEAL
      Output a line_to_zone table covering ALL lines.
    </step>

    <step id="S4_allocate_cells">
      Allocate cell counts per line based on weights, with constraints:
      - total assigned cells <= 576
      - SEAL line(s) must occupy SEAL cells and also echo lightly on rim
      - ABSENCE_FIELD must include a contiguous region with intentionally low character density
      - Friezes must read as continuous bands (avoid scattered pixels)
    </step>

    <step id="S5_pack_text">
      For each allocated cell, choose a chunk strategy:
      - "full_line" for high-clarity zones (rim, frieze titles)
      - "fragment_loop" for chorus lines (repeat motif fragments)
      - "dense_stack" for high-intensity affect lines
      - "white_space" for absence (sparse fragments, more blanks)
      Ensure the surface-text is legible in scan windows (raycaster strips).
    </step>

    <step id="S6_emit_manifest">
      Output MUST include:
      1) grid[24][24] array of objects:
         {x,y, zone, line_id, text_chunk, density, motifs, function}
      2) index.line_to_cells: {line_id: [{x,y}...]}
      3) index.zone_summary: counts and density averages
      4) regenerate_instructions: deterministic rules to rebuild from inputs
    </step>

    <step id="S7_quality_checks">
      Run and report checks:
      - coverage: all lines appear at least once
      - seal: axiom appears at center
      - bands: friezes are continuous
      - void: absence region exists and is contiguous
      - balance: no single line exceeds 25% of total cells unless explicitly justified
    </step>
  </required_steps>

  <output_schema>
    <json>
      {
        "world": "KEATS_URN_24",
        "lines": [{"line_id":"K-01","text":"...","function":"...","motifs":["..."],"weight":0,"zone":"..."}],
        "allocation": {"K-01": 8, "...": 1},
        "grid": [[{"x":0,"y":0,"zone":"RIM_TOP","line_id":"K-01","text_chunk":"...","density":0.6,"motifs":["..."],"function":"invocation"}, ...], ...],
        "index": {
          "line_to_cells": {"K-01":[{"x":1,"y":1}, ...]},
          "zone_summary": {"RIM_TOP":{"cells":0,"avg_density":0.0}, "...":{}}
        },
        "regenerate_instructions": ["..."],
        "checks": {"all_lines_covered":true,"seal_ok":true,"frieze_continuity_ok":true,"absence_contiguous_ok":true}
      }
    </json>
  </output_schema>

  <constraints>
    <c>Do not invent new poem lines; you may fragment existing lines.</c>
    <c>Prefer short chunks (20–80 chars) per cell unless density strategy says otherwise.</c>
    <c>Optimization goal: the user should be able to “read by walking.”</c>
  </constraints>

</prompt> Ode on a Grecian Urn

By John Keats
Thou still unravish'd bride of quietness,
       Thou foster-child of silence and slow time,
Sylvan historian, who canst thus express
       A flowery tale more sweetly than our rhyme:
What leaf-fring'd legend haunts about thy shape
       Of deities or mortals, or of both,
               In Tempe or the dales of Arcady?
       What men or gods are these? What maidens loth?
What mad pursuit? What struggle to escape?
               What pipes and timbrels? What wild ecstasy?

Heard melodies are sweet, but those unheard
       Are sweeter; therefore, ye soft pipes, play on;
Not to the sensual ear, but, more endear'd,
       Pipe to the spirit ditties of no tone:
Fair youth, beneath the trees, thou canst not leave
       Thy song, nor ever can those trees be bare;
               Bold Lover, never, never canst thou kiss,
Though winning near the goal yet, do not grieve;
       She cannot fade, though thou hast not thy bliss,
               For ever wilt thou love, and she be fair!

Ah, happy, happy boughs! that cannot shed
         Your leaves, nor ever bid the Spring adieu;
And, happy melodist, unwearied,
         For ever piping songs for ever new;
More happy love! more happy, happy love!
         For ever warm and still to be enjoy'd,
                For ever panting, and for ever young;
All breathing human passion far above,
         That leaves a heart high-sorrowful and cloy'd,
                A burning forehead, and a parching tongue.

Who are these coming to the sacrifice?
         To what green altar, O mysterious priest,
Lead'st thou that heifer lowing at the skies,
         And all her silken flanks with garlands drest?
What little town by river or sea shore,
         Or mountain-built with peaceful citadel,
                Is emptied of this folk, this pious morn?
And, little town, thy streets for evermore
         Will silent be; and not a soul to tell
                Why thou art desolate, can e'er return.

O Attic shape! Fair attitude! with brede
         Of marble men and maidens overwrought,
With forest branches and the trodden weed;
         Thou, silent form, dost tease us out of thought
As doth eternity: Cold Pastoral!
         When old age shall this generation waste,
                Thou shalt remain, in midst of other woe
Than ours, a friend to man, to whom thou say'st,
         "Beauty is truth, truth beauty,—that is all
                Ye know on earth, and all ye need to know."